<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<style>
#id, #password, #number, #email{
  font-family: "굴림", gulim, arial, helvetica, sans-serif;
}
</style>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>금오공과대학교 명예옷장</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Free HTML5 Website Template by FreeHTML5.co" />
    <meta name="keywords"
        content="free html5, free template, free bootstrap, free website template, html5, css3, mobile first, responsive" />
    <meta name="author" content="FreeHTML5.co" />

    <!-- 
	//////////////////////////////////////////////////////

	FREE HTML5 TEMPLATE 
	DESIGNED & DEVELOPED by FreeHTML5.co
		
	Website: 		http://freehtml5.co/
	Email: 			info@freehtml5.co
	Twitter: 		http://twitter.com/fh5co
	Facebook: 		https://www.facebook.com/fh5co

	//////////////////////////////////////////////////////
	 -->

    <!-- Facebook and Twitter integration -->
    <meta property="og:title" content="" />
    <meta property="og:image" content="" />
    <meta property="og:url" content="" />
    <meta property="og:site_name" content="" />
    <meta property="og:description" content="" />
    <meta name="twitter:title" content="" />
    <meta name="twitter:image" content="" />
    <meta name="twitter:url" content="" />
    <meta name="twitter:card" content="" />


    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <link rel="shortcut icon" href="favicon.ico">

    <link href='https://fonts.googleapis.com/css?family=Roboto:400,300,600,400italic,700' rel='stylesheet'
        type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>

    <!-- Animate.css -->
    <link rel="stylesheet" href="css/CLIENT_css/animate.css">
    <!-- Icomoon Icon Fonts-->
    <link rel="stylesheet" href="css/CLIENT_css/icomoon.css">
    <!-- Bootstrap  -->
    <link rel="stylesheet" href="css/CLIENT_css/bootstrap.css">
    <!-- Owl Carousel -->
    <link rel="stylesheet" href="css/CLIENT_css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/CLIENT_css/owl.theme.default.min.css">
    <!-- Theme style  -->
    <link rel="stylesheet" href="css/CLIENT_css/style.css">

    <link rel="stylesheet" href="css/CLIENT_css/productmodal.css">

    <link rel="stylesheet" href="css/CLIENT_css/sign.css">
    <!-- Modernizr JS -->
    <script src="js/CLIENT_js/modernizr-2.6.2.min.js"></script>
    <!-- FOR IE9 below -->
    <!--[if lt IE 9]>
	<script src="js/respond.min.js"></script>
	<![endif]-->
    <script src="js/CLIENT_js/login.js"></script>
    <script src="./admin/js/ADMIN_js/includeHTML.js"></script>
</head>

<body>
    <div id="includeHTML" include-html="topNavibar.html"></div>

    <div id="includeHTML" include-html="aside.html"></div>

    <div class="fh5co-narrow-content">
        <div class="row animate-box" data-animate-effect="fadeInLeft">
            <div class="container" id="container">

                <h2 style="font-size: 50px">회원정보 수정</h2><br><br>
                <div style="width: 100%">아이디 &nbsp;<input type="id" placeholder="ID" name='id' id='id' readonly /></div>
                <div style="width: 100%">비밀번호 &nbsp;<input type="password" placeholder="Password" id='password'
                        readonly />&nbsp;<a onclick="openModal()" data-toggle="modal" data-backdrop="static"
                        data-keyboard="false" href="#pwdmodal"><i class="icon-edit" style="float:right"></i></a>
                </div>
                <div style="width: 100%">휴대전화 &nbsp;<input type="text" placeholder="PhoneNumber('-'제외)" name="number"
                        id='number' /></div>
                <div style="width: 100%">이메일 &nbsp;<input type="email" placeholder="Email" name='email' id='email' />
                </div>
                <br>
                <br>
                <div style="width: 100%;">
                    <button id="Update_Button" style="display: block; margin: 0 auto;">수정</button>
                </div>
                <div style="width: 100%; text-align: center;">
                    <a id="Withdrawal_Button" style="float:right;">회원탈퇴</a></div>
            </div>
        </div>
    </div>
    </div>

    <div class="modal fade" id="pwdmodal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-content" style="max-width: 1300px; margin: 0 auto; margin-top:3%; margin-bottom:3%">
            <div class="modal-body" style="height: 500px"><span><a class="close" onclick="closeModal();"
                        style="color:black;">&times;</a></span>
                <main class="mt-5 pt-4">
                    <div class="container dark-grey-text mt-5" style="min-height: 0px">
                        <div class="row wow fadeIn">
                            <br>
                            <br>
                            <div style="width: 100%">비밀번호 변경&nbsp;<input type="password" placeholder="Password"
                                    id='changepwd' /></div>
                            <div style="width: 100%">비밀번호 변경 확인 &nbsp;<input type="password"
                                    placeholder="Password Confirm" id='changepwd2' /></div>
                        </div>
                        <br>
                        <br>
                        <div style="width: 100%; text-align: center"><button type="button" id="changeconfirm"
                                onclick="changepwd()">확인</button></div>
                    </div>
                </main>
            </div>
        </div>
    </div>



    <!-- jQuery -->
    <script src="js/CLIENT_js/jquery.min.js"></script>
    <!-- jQuery Easing -->
    <script src="js/CLIENT_js/jquery.easing.1.3.js"></script>
    <!-- Bootstrap -->
    <script src="js/CLIENT_js/bootstrap.min.js"></script>
    <!-- Carousel -->
    <script src="js/CLIENT_js/owl.carousel.min.js"></script>
    <!-- Stellar -->
    <script src="js/CLIENT_js/jquery.stellar.min.js"></script>
    <!-- Waypoints -->
    <script src="js/CLIENT_js/jquery.waypoints.min.js"></script>
    <!-- Counters -->
    <script src="js/CLIENT_js/jquery.countTo.js"></script>
    <script>
        includeHTML();

    </script>
    <!-- MAIN JS -->
    <script src="js/CLIENT_js/main.js"></script>

</body>

<script>
    function closeModal() {
        $(pwdmodal).modal('hide');
        $('body').removeClass('modal-open');
        $('.modal-backdrop').remove();
        $('#sidebar').show();
    }

    function openModal() {
        $('#sidebar').hide();
    }

    function changepwd() {
        var pwd1 = document.getElementById('changepwd').value;
        var pwd2 = document.getElementById('changepwd2').value;
        var pwdRule = /^[A-Za-z0-9]{6,20}$/;
        if (!pwdRule.test(pwd1)) {
            alert('비밀번호는 6자 이상, 20자 이하의 영문자/숫자 이어야합니다.');
            return;
        }
        if (pwd1 == pwd2) {
            $(pwdmodal).modal('hide');
            $('body').removeClass('modal-open');
            $('.modal-backdrop').remove();
            $('#sidebar').show();
            document.getElementById('password').value = pwd1;
        } else {
            alert('비밀번호가 일치하지 않습니다!');
        }

    }

    $.ajax({
        type: "POST",
        url: '/Login/loadCustomer',
        success: function (data) {
            var id = document.getElementById('id');
            var password = document.getElementById('password');
            var number = document.getElementById('number');
            var email = document.getElementById('email');

            id.value = data[0].ID;
            password.value = data[0].Password;
            number.value = data[0].PhoneNum;
            email.value = data[0].E_mail;
        },
        error: function (e) {
            alert(e.responseText);
        }
    });

    var Update_Button = document.getElementById('Update_Button');
    Update_Button.addEventListener('click', function () {
        var id = document.getElementById('id').value;
        var password = document.getElementById('password').value;
        var number = document.getElementById('number').value;
        var email = document.getElementById('email').value;

        var phoneRule = /^\d{11,11}$/;
        if (!phoneRule.test(number)) {
            alert('전화번호는 "-"를 뺀 11자리의 숫자만 작성해주세요. ( 예시 : 01012341234 )');
            return;
        }

        var emailRule = /^[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*.[a-zA-Z]{2,3}$/i;
        if (!emailRule.test(email)) {
            alert('이메일 형식으로 작성해주세요. ( 예 : ABC1234@naver.com )');
            return;
        }

        var DATA = {
            "id": id,
            "password": password,
            "number": number,
            "email": email
        }

        $.ajax({
            type: "POST",
            url: '/Login/updateCustomer',
            data: DATA,
            dataType: 'json',
            success: function (data) {
                alert("수정 되었습니다.");
                window.location.href = "index.html";
            },
            error: function (e) {
                alert(e.responseText);
            }
        });
    })

    var Withdrawal_Button = document.getElementById('Withdrawal_Button');
    Withdrawal_Button.addEventListener('click', function () {
        var isWithdrawal = confirm('정말로 탈퇴하시겠습니까?');
        console.log(isWithdrawal);
        if (isWithdrawal == true) {
            $.ajax({
                type: "POST",
                url: '/Login/Withdrawal',
                async: false,
                success: function (data) {
                    alert("탈퇴되었습니다.");

                    $.ajax({
                        type: "GET",
                        url: '/login/auth/logout',
                        async: false,
                        success: function (data) {
                            window.location.href = "index.html";
                        },
                        error: function (e) {
                            alert(e.responseText);
                        }
                    });
                },
                error: function (e) {
                    alert(e.responseText);
                }
            });
        }
    })
</script>

</html>